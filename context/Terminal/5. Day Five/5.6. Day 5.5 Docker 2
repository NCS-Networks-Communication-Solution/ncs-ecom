Last login: Wed Oct  1 13:53:48 on ttys004
pkaewmanee@Phakkhapons-MacBook-Pro ~ % cd Desktop/Project_Hiroshima
pkaewmanee@Phakkhapons-MacBook-Pro Project_Hiroshima % cd ncs-ecom
pkaewmanee@Phakkhapons-MacBook-Pro ncs-ecom % DOCKER_BUILDKIT=0 COMPOSE_DOCKER_CLI_BUILD=0 docker compose build backend
WARN[0000] Docker Compose is configured to build using Bake, but buildkit isn't enabled 
[+] Building 0/1
[+] Building 0/1nd  Building                                               3.1s 
[+] Building 0/1nd  Building                                               3.8s 
 ⠇ Service backend  Building                                               3.9s 
 ---> 8d6421d663b4
[+] Building 0/1DIR /app
 ⠏ Service backend  Building                                               5.0s 
 ---> Removed intermediate container 986f09f27f37
[+] Building 0/13c
 ⠸ Service backend  Building                                               5.4s 
 ---> da6a88284b13
[+] Building 0/1npm ci
 ⠧ Service backend  Building                                               9.8s 
npm warn deprecated supertest@6.3.4: Please upgrade to supertest v7.1.3+, see re[+] Building 0/1ttps://github.com/forwardemail/supertest/releases/tag/v7.1.3 - m ⠋ Service backend  Building                                              10.1s 
[+] Building 0/1ted rimraf@3.0.2: Rimraf versions prior to v4 are no longer supp ⠸ Service backend  Building                                              10.4s 
npm warn deprecated superagent@8.1.2: Please upgrade to superagent v10.2.2+, see[+] Building 0/1t https://github.com/forwardemail/superagent/releases/tag/v10.2.[+] Building 0/1nd  Building                                              11.0s 
 ⠸ Service backend  Building                                              12.4s 
npm warn deprecated inflight@1.0.6: This module is not supported, and leaks memory. Do not use it. Check out lru-cache if you want a good and tested way to coal[+] Building 0/1sts by a key value, which is much more comprehensive and powerfu[+] Building 0/1nd  Building                                              12.9s 
[+] Building 0/1nd  Building                                              15.7s 
 ⠙ Service backend  Building                                              19.2s 
[+] Building 0/1ted glob@7.2.3: Glob versions prior to v9 are no longer supporte ⠴ Service backend  Building                                              19.6s 
[+] Building 0/1ted glob@7.2.3: Glob versions prior to v9 are no longer supporte ⠦ Service backend  Building                                              19.7s 
[+] Building 0/1ted glob@7.2.3: Glob versions prior to v9 are no longer supporte ⠧ Service backend  Building                                              19.8s 
[+] Building 0/1ted glob@7.2.3: Glob versions prior to v9 are no longer supporte ⠴ Service backend  Building                                              20.6s 
[+] Building 0/1ted glob@7.2.3: Glob versions prior to v9 are no longer supporte ⠴ Service backend  Building                                              41.6s 

added 830 packages, and audited 831 packages in 36s

139 packages are looking for funding
  run `npm fund` for details

5 low severity vulnerabilities

To address all issues (including breaking changes), run:
  npm audit fix --force

Run `npm audit` for details.
npm notice
npm notice New major version of npm available! 10.8.2 -> 11.6.1
npm notice Changelog: https://github.com/npm/cli/releases/tag/v11.6.1
[+] Building 0/1date run: npm install -g npm@11.6.1
 ⠋ Service backend  Building                                              71.1s 
 ---> Removed intermediate container 6b05b53d1f58
 ---> e30d952f06e5
Step 5/10 : FROM deps AS dev
[+] Building 0/1e5
[+] Building 0/1nd  Building                                              72.3s 
 ⠋ Service backend  Building                                              75.1s 
 ---> Removed intermediate container dc7874ca2054
 ---> e1c4dd22ff7a
[+] Building 0/1NODE_ENV=development
 ⠴ Service backend  Building                                              77.6s 
 ---> Removed intermediate container b408683d0d90
[+] Building 0/144
 ⠋ Service backend  Building                                              80.1s 
[+] Building 0/19f
[+] Building 0/1nd  Building                                              80.2s 
 ⠦ Service backend  Building                                              82.7s 
 ---> Removed intermediate container a94180cabcf3
[+] Building 0/1d1
[+] Building 0/1nd  Building                                              82.8s 
 ⠹ Service backend  Building                                              85.3s 
 ---> Removed intermediate container 1fcd81a3e8a3
 ---> fd05523a7642
[+] Building 2/2lt fd05523a7642
 ✔ Service backend  Built                                                 85.3s 
 ✔ backend          Built                                                  0.0s 
pkaewmanee@Phakkhapons-MacBook-Pro ncs-ecom % docker compose up -d
[+] Running 6/6
 ✔ Network ncs-ecom_default       Created                                  0.1s 
 ✔ Volume "ncs-ecom_redisdata"    Created                                  0.0s 
 ✔ Volume "ncs-ecom_pgdata"       Created                                  0.0s 
 ✔ Container ncs-ecom-postgres-1  Healt...                                11.0s 
 ✔ Container ncs-ecom-redis-1     Healthy                                 11.0s 
 ✔ Container ncs-ecom-backend-1   Starte...                               11.1s 
pkaewmanee@Phakkhapons-MacBook-Pro ncs-ecom % docker compose ps
NAME                  IMAGE                COMMAND                  SERVICE    CREATED          STATUS                            PORTS
ncs-ecom-backend-1    ncs-ecom-backend     "docker-entrypoint.s…"   backend    16 seconds ago   Up 4 seconds (health: starting)   0.0.0.0:3000->3000/tcp, [::]:3000->3000/tcp
ncs-ecom-postgres-1   postgres:15-alpine   "docker-entrypoint.s…"   postgres   16 seconds ago   Up 15 seconds (healthy)           0.0.0.0:5432->5432/tcp, [::]:5432->5432/tcp
ncs-ecom-redis-1      redis:7-alpine       "docker-entrypoint.s…"   redis      16 seconds ago   Up 15 seconds (healthy)           0.0.0.0:6379->6379/tcp, [::]:6379->6379/tcp
pkaewmanee@Phakkhapons-MacBook-Pro ncs-ecom % curl http://localhost:3000/api/health
curl: (56) Recv failure: Connection reset by peer
pkaewmanee@Phakkhapons-MacBook-Pro ncs-ecom % node frontend/scripts/smoke.mjs
❌ Smoke checks failed: fetch failed
pkaewmanee@Phakkhapons-MacBook-Pro ncs-ecom % DOCKER_BUILDKIT=0 COMPOSE_DOCKER_CLI_BUILD=0 docker compose build backend
WARN[0000] Docker Compose is configured to build using Bake, but buildkit isn't enabled 
[+] Building 0/1
 ⠹ Service backend  Building                                               0.3s 
Sending build context to Docker daemon  115.1kB
Step 1/10 : FROM node:18-alpine AS deps
 ---> 8d6421d663b4
Step 2/10 : WORKDIR /app
 ---> Using cache
 ---> 98a557f41e3c
Step 3/10 : COPY package.json package-lock.json ./
 ---> Using cache
 ---> da6a88284b13
Step 4/10 : RUN npm ci
 ---> Using cache
[+] Building 0/1e5
 ⠸ Service backend  Building                                               0.4s 
 ---> e30d952f06e5
Step 6/10 : WORKDIR /app
 ---> Using cache
 ---> e1c4dd22ff7a
Step 7/10 : ENV NODE_ENV=development
 ---> Using cache
[+] Building 0/144
 ⠋ Service backend  Building                                               3.1s 
 ---> 6c9d1b0f7b6f
[+] Building 0/1["npm", "run", "start:dev"]
 ⠧ Service backend  Building                                               5.8s 
 ---> Removed intermediate container ba0d0f4048cb
[+] Building 0/19e
[+] Building 0/1nd  Building                                               5.9s 
 ⠼ Service backend  Building                                               8.5s 
 ---> Removed intermediate container cf819232a49d
[+] Building 0/1a9
[+] Building 2/2nd  Building                                               8.6s 
 ✔ Service backend  Built                                                  8.6s 
 ✔ backend          Built                                                  0.0s 
pkaewmanee@Phakkhapons-MacBook-Pro ncs-ecom % docker compose up -d
[+] Running 3/3
 ✔ Container ncs-ecom-redis-1     Healthy                                  1.5s 
 ✔ Container ncs-ecom-postgres-1  Healt...                                 1.5s 
 ✔ Container ncs-ecom-backend-1   Starte...                                1.7s 
pkaewmanee@Phakkhapons-MacBook-Pro ncs-ecom % docker compose exec backend npx prisma generate
warn The configuration property `package.json#prisma` is deprecated and will be removed in Prisma 7. Please migrate to a Prisma config file (e.g., `prisma.config.ts`).
For more information, see: https://pris.ly/prisma-config

Prisma schema loaded from prisma/schema.prisma

✔ Generated Prisma Client (v6.16.2) to ./node_modules/@prisma/client in 217ms

Start by importing your Prisma Client (See: https://pris.ly/d/importing-client)

Tip: Interested in query caching in just a few lines of code? Try Accelerate today! https://pris.ly/tip-3-accelerate

pkaewmanee@Phakkhapons-MacBook-Pro ncs-ecom % docker compose exec backend npx prisma migrate deploy

warn The configuration property `package.json#prisma` is deprecated and will be removed in Prisma 7. Please migrate to a Prisma config file (e.g., `prisma.config.ts`).
For more information, see: https://pris.ly/prisma-config

Prisma schema loaded from prisma/schema.prisma
Datasource "db": PostgreSQL database "ncsdb", schema "public" at "postgres:5432"

3 migrations found in prisma/migrations


┌─────────────────────────────────────────────────────────┐
│  Update available 6.16.2 -> 6.16.3                      │
│  Run the following to update                            │
│    npm i --save-dev prisma@latest                       │
│    npm i @prisma/client@latest                          │
└─────────────────────────────────────────────────────────┘
No pending migrations to apply.
pkaewmanee@Phakkhapons-MacBook-Pro ncs-ecom % docker compose exec backend npx prisma db seed
warn The configuration property `package.json#prisma` is deprecated and will be removed in Prisma 7. Please migrate to a Prisma config file (e.g., `prisma.config.ts`).
For more information, see: https://pris.ly/prisma-config

Running seed command `ts-node prisma/seed.ts` ...
🌱 Starting database seeding...
🧹 Cleaning existing data...
🏢 Creating companies...
👥 Creating users...
📂 Creating categories...
📦 Creating products...
✅ Database seeded successfully!
📊 Summary:
  Companies: 2
  Users: 3
  Categories: 3
  Products: 7

🔐 Test Login Credentials:
  Admin: admin@ncs.co.th / admin123
  Sales: sales@ncs.co.th / user123
  Buyer: buyer@test.com / user123

🌱  The seed command has been executed.
pkaewmanee@Phakkhapons-MacBook-Pro ncs-ecom % docker compose restart backend

[+] Restarting 1/1
 ✔ Container ncs-ecom-backend-1  Started                                   0.9s 
pkaewmanee@Phakkhapons-MacBook-Pro ncs-ecom % docker compose ps
NAME                  IMAGE                COMMAND                  SERVICE    CREATED          STATUS                             PORTS
ncs-ecom-backend-1    ncs-ecom-backend     "docker-entrypoint.s…"   backend    49 seconds ago   Up 10 seconds (health: starting)   0.0.0.0:3000->3000/tcp, [::]:3000->3000/tcp
ncs-ecom-postgres-1   postgres:15-alpine   "docker-entrypoint.s…"   postgres   9 minutes ago    Up 9 minutes (healthy)             0.0.0.0:5432->5432/tcp, [::]:5432->5432/tcp
ncs-ecom-redis-1      redis:7-alpine       "docker-entrypoint.s…"   redis      9 minutes ago    Up 9 minutes (healthy)             0.0.0.0:6379->6379/tcp, [::]:6379->6379/tcp
pkaewmanee@Phakkhapons-MacBook-Pro ncs-ecom % curl http://localhost:3000/api/health
node frontend/scripts/smoke.mjs
{"status":"ok","message":"NCS Backend API is running"}✅ Catalog returned 7 products
✅ Authentication endpoint responded with access & refresh tokens
🚀 Smoke checks completed successfully.
pkaewmanee@Phakkhapons-MacBook-Pro ncs-ecom % 
