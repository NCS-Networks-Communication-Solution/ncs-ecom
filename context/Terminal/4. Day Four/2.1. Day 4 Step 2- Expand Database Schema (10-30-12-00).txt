Last login: Mon Sep 29 13:06:53 on ttys000
pkaewmanee@Phakkhapons-MacBook-Pro ~ % cd ~/Desktop/Project_Hiroshima/ncs-ecom
pkaewmanee@Phakkhapons-MacBook-Pro ncs-ecom % docker compose up postgres redis -d
[+] Running 2/2
 ‚úî Container ncs-ecom-postgres-1  Runni...                                 0.0s 
 ‚úî Container ncs-ecom-redis-1     Running                                  0.0s 
pkaewmanee@Phakkhapons-MacBook-Pro ncs-ecom % cd backend

pkaewmanee@Phakkhapons-MacBook-Pro backend % npx prisma migrate dev --name complete_schema
warn The configuration property `package.json#prisma` is deprecated and will be removed in Prisma 7. Please migrate to a Prisma config file (e.g., `prisma.config.ts`).
For more information, see: https://pris.ly/prisma-config

Environment variables loaded from .env
Prisma schema loaded from prisma/schema.prisma
Datasource "db": PostgreSQL database "ncsdb", schema "public" at "localhost:5432"


‚ö†Ô∏è  Warnings for the current datasource:

  ‚Ä¢ You are about to drop the `Company` table, which is not empty (1 rows).
  ‚Ä¢ You are about to drop the `User` table, which is not empty (2 rows).

‚úî Are you sure you want to create and apply this migration? ‚Ä¶ no
Migration cancelled.
pkaewmanee@Phakkhapons-MacBook-Pro backend % npx prisma db push --accept-data-loss
warn The configuration property `package.json#prisma` is deprecated and will be removed in Prisma 7. Please migrate to a Prisma config file (e.g., `prisma.config.ts`).
For more information, see: https://pris.ly/prisma-config

Environment variables loaded from .env
Prisma schema loaded from prisma/schema.prisma
Datasource "db": PostgreSQL database "ncsdb", schema "public" at "localhost:5432"

‚ö†Ô∏è  There might be data loss when applying the changes:

  ‚Ä¢ You are about to drop the `Company` table, which is not empty (1 rows).

  ‚Ä¢ You are about to drop the `User` table, which is not empty (2 rows).



üöÄ  Your database is now in sync with your Prisma schema. Done in 232ms

‚úî Generated Prisma Client (v6.16.2) to ./node_modules/@prisma/client in 126ms

pkaewmanee@Phakkhapons-MacBook-Pro backend % pg_dump -h localhost -U ncsadmin -d ncsdb > backup_before_schema_expansion.sql
zsh: command not found: pg_dump
pkaewmanee@Phakkhapons-MacBook-Pro backend % npx prisma migrate dev --name complete_schema
warn The configuration property `package.json#prisma` is deprecated and will be removed in Prisma 7. Please migrate to a Prisma config file (e.g., `prisma.config.ts`).
For more information, see: https://pris.ly/prisma-config

Environment variables loaded from .env
Prisma schema loaded from prisma/schema.prisma
Datasource "db": PostgreSQL database "ncsdb", schema "public" at "localhost:5432"

Drift detected: Your database schema is not in sync with your migration history.

The following is a summary of the differences between the expected database schema given your migrations files, and the actual schema of the database.

It should be understood as the set of changes to get from the expected schema to the actual schema.

[+] Added enums
  - OrderStatus
  - QuoteStatus

[+] Added tables
  - carts
  - categories
  - companies
  - order_items
  - orders
  - payments
  - products
  - quote_items
  - quotes
  - users

[-] Removed tables
  - Company
  - User

[*] Changed the `Role` enum
  [+] Added variant `PURCHASER`
  [+] Added variant `APPROVER`

[*] Changed the `User` table
  [-] Removed foreign key on columns (companyId)

[*] Changed the `carts` table
  [+] Added unique index on columns (user_id, product_id)
  [+] Added foreign key on columns (product_id)
  [+] Added foreign key on columns (user_id)

[*] Changed the `categories` table
  [+] Added unique index on columns (name)

[*] Changed the `companies` table
  [+] Added unique index on columns (name)
  [+] Added unique index on columns (tax_id)

[*] Changed the `order_items` table
  [+] Added foreign key on columns (order_id)
  [+] Added foreign key on columns (product_id)

[*] Changed the `orders` table
  [+] Added unique index on columns (order_no)
  [+] Added unique index on columns (quote_id)
  [+] Added foreign key on columns (company_id)
  [+] Added foreign key on columns (quote_id)
  [+] Added foreign key on columns (user_id)

[*] Changed the `payments` table
  [+] Added unique index on columns (order_id)
  [+] Added foreign key on columns (order_id)

[*] Changed the `products` table
  [+] Added unique index on columns (sku)
  [+] Added foreign key on columns (category_id)

[*] Changed the `quote_items` table
  [+] Added foreign key on columns (product_id)
  [+] Added foreign key on columns (quote_id)

[*] Changed the `quotes` table
  [+] Added unique index on columns (quote_no)
  [+] Added foreign key on columns (company_id)
  [+] Added foreign key on columns (user_id)

[*] Changed the `users` table
  [+] Added unique index on columns (email)
  [+] Added foreign key on columns (company_id)

We need to reset the "public" schema at "localhost:5432"

You may use prisma migrate reset to drop the development database.
All data will be lost.
pkaewmanee@Phakkhapons-MacBook-Pro backend % npx prisma db seed

warn The configuration property `package.json#prisma` is deprecated and will be removed in Prisma 7. Please migrate to a Prisma config file (e.g., `prisma.config.ts`).
For more information, see: https://pris.ly/prisma-config

Environment variables loaded from .env
Running seed command `ts-node --compiler-options {"module":"CommonJS"} prisma/seed.ts` ...
Created/Found company: {
  id: 'ncs-company-001',
  name: 'NCS Network Communications',
  taxId: null,
  tier: 'STANDARD',
  createdAt: 2025-09-29T06:48:47.007Z,
  updatedAt: 2025-09-29T06:48:47.007Z
}
Created/Updated admin user: admin@ncs.co.th
Created/Updated test user: user@ncs.co.th
‚úÖ Database seeding completed successfully!
üîê Admin credentials: admin@ncs.co.th / admin123
üë§ Test user credentials: user@ncs.co.th / user123

üå±  The seed command has been executed.
pkaewmanee@Phakkhapons-MacBook-Pro backend % docker exec -it ncs-ecom-postgres-1 psql -U ncsadmin -d ncsdb -c '\dt'
               List of relations
 Schema |        Name        | Type  |  Owner   
--------+--------------------+-------+----------
 public | _prisma_migrations | table | ncsadmin
 public | carts              | table | ncsadmin
 public | categories         | table | ncsadmin
 public | companies          | table | ncsadmin
 public | order_items        | table | ncsadmin
 public | orders             | table | ncsadmin
 public | payments           | table | ncsadmin
 public | products           | table | ncsadmin
 public | quote_items        | table | ncsadmin
 public | quotes             | table | ncsadmin
 public | users              | table | ncsadmin
(11 rows)

pkaewmanee@Phakkhapons-MacBook-Pro backend % npx prisma studio
warn The configuration property `package.json#prisma` is deprecated and will be removed in Prisma 7. Please migrate to a Prisma config file (e.g., `prisma.config.ts`).
For more information, see: https://pris.ly/prisma-config

Environment variables loaded from .env
Prisma schema loaded from prisma/schema.prisma
Prisma Studio is up on http://localhost:5555
Prisma schema loaded from prisma/schema.prisma
^C
pkaewmanee@Phakkhapons-MacBook-Pro backend % npx prisma migrate dev --name complete_schema
npx prisma generate
warn The configuration property `package.json#prisma` is deprecated and will be removed in Prisma 7. Please migrate to a Prisma config file (e.g., `prisma.config.ts`).
For more information, see: https://pris.ly/prisma-config

Environment variables loaded from .env
Prisma schema loaded from prisma/schema.prisma
Datasource "db": PostgreSQL database "ncsdb", schema "public" at "localhost:5432"

Drift detected: Your database schema is not in sync with your migration history.

The following is a summary of the differences between the expected database schema given your migrations files, and the actual schema of the database.

It should be understood as the set of changes to get from the expected schema to the actual schema.

[+] Added enums
  - OrderStatus
  - QuoteStatus

[+] Added tables
  - carts
  - categories
  - companies
  - order_items
  - orders
  - payments
  - products
  - quote_items
  - quotes
  - users

[-] Removed tables
  - Company
  - User

[*] Changed the `Role` enum
  [+] Added variant `PURCHASER`
  [+] Added variant `APPROVER`

[*] Changed the `User` table
  [-] Removed foreign key on columns (companyId)

[*] Changed the `carts` table
  [+] Added unique index on columns (user_id, product_id)
  [+] Added foreign key on columns (product_id)
  [+] Added foreign key on columns (user_id)

[*] Changed the `categories` table
  [+] Added unique index on columns (name)

[*] Changed the `companies` table
  [+] Added unique index on columns (name)
  [+] Added unique index on columns (tax_id)

[*] Changed the `order_items` table
  [+] Added foreign key on columns (order_id)
  [+] Added foreign key on columns (product_id)

[*] Changed the `orders` table
  [+] Added unique index on columns (order_no)
  [+] Added unique index on columns (quote_id)
  [+] Added foreign key on columns (company_id)
  [+] Added foreign key on columns (quote_id)
  [+] Added foreign key on columns (user_id)

[*] Changed the `payments` table
  [+] Added unique index on columns (order_id)
  [+] Added foreign key on columns (order_id)

[*] Changed the `products` table
  [+] Added unique index on columns (sku)
  [+] Added foreign key on columns (category_id)

[*] Changed the `quote_items` table
  [+] Added foreign key on columns (product_id)
  [+] Added foreign key on columns (quote_id)

[*] Changed the `quotes` table
  [+] Added unique index on columns (quote_no)
  [+] Added foreign key on columns (company_id)
  [+] Added foreign key on columns (user_id)

[*] Changed the `users` table
  [+] Added unique index on columns (email)
  [+] Added foreign key on columns (company_id)

We need to reset the "public" schema at "localhost:5432"

You may use prisma migrate reset to drop the development database.
All data will be lost.
warn The configuration property `package.json#prisma` is deprecated and will be removed in Prisma 7. Please migrate to a Prisma config file (e.g., `prisma.config.ts`).
For more information, see: https://pris.ly/prisma-config

Environment variables loaded from .env
Prisma schema loaded from prisma/schema.prisma

‚úî Generated Prisma Client (v6.16.2) to ./node_modules/@prisma/client in 118ms

Start by importing your Prisma Client (See: https://pris.ly/d/importing-client)

Tip: Need your database queries to be 1000x faster? Accelerate offers you that and more: https://pris.ly/tip-2-accelerate

pkaewmanee@Phakkhapons-MacBook-Pro backend % 
